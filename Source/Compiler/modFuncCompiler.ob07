ŒŽ„“‹œ modFuncCompiler;

(* á®¤¥à¦¨â à §«¨ç­ë¥ ¬¥«ª¨¥ ¢á¯®¬®£ â¥«ì­ë¥ äã­ªæ¨¨, ­¥®¡å®¤¨¬ë¥ ª®¬¯¨«ïâ®àã
    *)

ˆŒŽ’ ¬„¥æ := DECL, X86, SCAN,
  ¬Š®­áâ := modConstante,
  ¬à®¢ := modAssertion,
  ¬Š® := modConstErr,
  ¬’¨¯ë := modType;

Ž–…„“€ …á«¨‘âà®ª *(¢ëà ¦_: ¬„¥æ.â‚ëà ¦¥­¨¥): “‹…‚Ž;
      ‚…“’œ (¢ëà ¦_.â¨¯.â¨¯_ã§«  = ¬Š®­áâ._â‘âà®ª ) ˆ‹ˆ (¢ëà ¦_.â¨¯.â¨¯_ã§«  = ¬Š®­áâ._âŒ áá¨¢) &
        (¢ëà ¦_.â¨¯.¯à¥¤®ª.â¨¯_ã§«  = ¬Š®­áâ._â‘¨¬¢®«)
    ŠŽ…– …á«¨‘âà®ª ;

Ž–…„“€ à®¢¥à¨âì*(ª«îç_: –…‹Ž…);
    €—€‹Ž
      ¬„¥æ.à®¢¥à¨âì(ª«îç_)
    ŠŽ…– à®¢¥à¨âì;

Ž–…„“€ ‘âà_®«ãç*(¤¢‡­ ç_: „‹ˆ‚…™): –…‹Ž…;
    ……Œ
        s: ¬„¥æ.STRCONST;
    €—€‹Ž
      s := ¬„¥æ.‘âà_®«ãç(¤¢‡­ ç_)
      ‚…“’œ s.Len
    ŠŽ…– ‘âà_®«ãç;

Ž–…„“€ Š®®à¤_“áâ*(……Œ áâà®ª _­®¬_, ¯®§¨æ¨ï_: –…‹Ž…);
    €—€‹Ž
      áâà®ª _­®¬_ := SCAN.áâà®ª _­®¬;
      ¯®§¨æ¨ï_ := SCAN.¯®§¨æ_£«®¡
    ŠŽ…– Š®®à¤_“áâ;

Ž–…„“€ ‚ëà ¦¥­¨¥_‡ £àã§¨âì*(¢ëà ¦_: ¬„¥æ.â‚ëà ¦¥­¨¥);
    €—€‹Ž
      …‘‹ˆ ¢ëà ¦_.eType = ¬Š®­áâ._eVAR ’Žƒ„€
        X86.Load(¢ëà ¦_.â¨¯.â¨¯_ã§« )
      ŠŽ…–
    ŠŽ…– ‚ëà ¦¥­¨¥_‡ £àã§¨âì;

Ž–…„“€ Š®®à¤‘«¥¤ãîé_“áâ*(……Œ áâà®ª _, ¯®§¨æ¨ï_: –…‹Ž…);
    €—€‹Ž
        ¬„¥æ.‹¥ªá¥¬_„ «ìè¥;
        Š®®à¤_“áâ(áâà®ª _, ¯®§¨æ¨ï_)
    ŠŽ…– Š®®à¤‘«¥¤ãîé_“áâ;

Ž–…„“€ ‘«¥¤ãîé_à®¢¥àª *(ª«îç_: –…‹Ž…);
    €—€‹Ž
        ¬„¥æ.‹¥ªá¥¬_„ «ìè¥;
        à®¢¥à¨âì(ª«îç_)
    ŠŽ…– ‘«¥¤ãîé_à®¢¥àª ;

Ž–…„“€ à®¢¥àª _„ «ìè¥*(ª«îç_: –…‹Ž…);
    €—€‹Ž
        à®¢¥à¨âì(ª«îç_);
        ¬„¥æ.‹¥ªá¥¬_„ «ìè¥
    ŠŽ…– à®¢¥àª _„ «ìè¥;

Ž–…„“€ ‡ £àã§¨âì_à®¢¥à¨âì*(¢ëà ¦_: ¬„¥æ.â‚ëà ¦¥­¨¥; ª«îç_: –…‹Ž…);
    €—€‹Ž
        ‚ëà ¦¥­¨¥_‡ £àã§¨âì(¢ëà ¦_);
        à®¢¥à¨âì(ª«îç_)
    ŠŽ…– ‡ £àã§¨âì_à®¢¥à¨âì;

Ž–…„“€ Func_Assert*(……Œ ¢ëà ¦¥­¨¥_: ¬„¥æ.â‚ëà ¦¥­¨¥; ……Œ áâà®ª _, ¯®§¨æ_:–…‹Ž…;
        ……Œ ¤¢‡­ ç_: „‹ˆ‚…™; ……Œ â¨¯_: ¬’¨¯ë.âã’¨¯);
    €—€‹Ž
        ¬à®¢.à®¢¥à¨âì(¢ëà ¦¥­¨¥_.â¨¯.â¨¯_ã§«  = ¬Š®­áâ._âã«¥¢®, áâà®ª _, ¯®§¨æ_, ¬Š®._®è108);
        ‚ëà ¦¥­¨¥_‡ £àã§¨âì(¢ëà ¦¥­¨¥_);
        …‘‹ˆ SCAN.«¥ªá_â¨¯ = ¬Š®­áâ._®¯‡¯â ’Žƒ„€
            Š®®à¤‘«¥¤ãîé_“áâ(áâà®ª _, ¯®§¨æ_);
            ¬„¥æ.ConstExpr(¤¢‡­ ç_, â¨¯_);
            ¬à®¢.à®¢¥à¨âì(â¨¯_.â¨¯_ã§«  = ¬Š®­áâ._â–¥«®¥, áâà®ª _, ¯®§¨æ_, ¬Š®._®è43);
            ¬à®¢.à®¢¥à¨âì((¤¢‡­ ç_ >= 0.0D0) & (¤¢‡­ ç_ <= 127.0D0), áâà®ª _, ¯®§¨æ_, ¬Š®._®è86);
            X86.Assert(¬Š®­áâ._stASSERT, FLOOR(¤¢‡­ ç_))
        ˆ€—…
            X86.Assert(¬Š®­áâ._stASSERT1, 0)
        ŠŽ…–
    ŠŽ…– Func_Assert;

Ž–…„“€ Func_PACK1*(……Œ ¢ëà ¦¥­¨¥_: ¬„¥æ.â‚ëà ¦¥­¨¥; ……Œ áâà®ª _, ¯®§¨æ_:–…‹Ž…; ……Œ ¤¢‡­ ç_: „‹ˆ‚…™;
        ……Œ â¨¯_: ¬’¨¯ë.âã’¨¯);
    €—€‹Ž
        ¬à®¢.à®¢¥à¨âì(¢ëà ¦¥­¨¥_.eType = ¬Š®­áâ._eVAR, áâà®ª _, ¯®§¨æ_, ¬Š®._®è54);
        ¬à®¢.à®¢¥à¨âì(¢ëà ¦¥­¨¥_.â¨¯.â¨¯_ã§«  ‚•Ž„ˆ’ {¬Š®­áâ._â‚¥é¥áâ¢, ¬Š®­áâ._â„«¨­‚¥é}, áâà®ª _, ¯®§¨æ_, ¬Š®._®è129);
        ¬à®¢.à®¢¥à¨âì(~¢ëà ¦¥­¨¥_.Read, áâà®ª _, ¯®§¨æ_, ¬Š®._®è106);
        à®¢¥à¨âì(¬Š®­áâ._®¯‡¯â);
        Š®®à¤‘«¥¤ãîé_“áâ(áâà®ª _, ¯®§¨æ_);
    ŠŽ…– Func_PACK1;

Ž–…„“€ Func_PACK2*(……Œ e2: ¬„¥æ.â‚ëà ¦¥­¨¥; ……Œ áâà®ª _, ¯®§¨æ_:–…‹Ž…; ……Œ ¤¢‡­ ç_: „‹ˆ‚…™;
        ……Œ â¨¯_: ¬’¨¯ë.âã’¨¯);
    €—€‹Ž
        ¬à®¢.à®¢¥à¨âì(e2.eType = ¬Š®­áâ._eVAR, áâà®ª _, ¯®§¨æ_, ¬Š®._®è54);
        ¬à®¢.à®¢¥à¨âì(e2.â¨¯.â¨¯_ã§«  = ¬Š®­áâ._â–¥«®¥, áâà®ª _, ¯®§¨æ_, ¬Š®._®è119);
        ¬à®¢.à®¢¥à¨âì(~e2.Read, áâà®ª _, ¯®§¨æ_, ¬Š®._®è106);
        …‘‹ˆ e2.â¨¯.â¨¯_ã§«  = ¬Š®­áâ._â„«¨­‚¥é ’Žƒ„€
            X86.StProc(¬Š®­áâ._stUNPK)
        ˆ€—…
            X86.StProc(¬Š®­áâ._stUNPK1)
        ŠŽ…–
    ŠŽ…– Func_PACK2;

Ž–…„“€ Func_PACK3*(……Œ e1, e2: ¬„¥æ.â‚ëà ¦¥­¨¥; ……Œ áâà®ª _, ¯®§¨æ_:–…‹Ž…; ……Œ ¤¢‡­ ç_: „‹ˆ‚…™);
    €—€‹Ž
        ¬à®¢.à®¢¥à¨âì(e2.â¨¯.â¨¯_ã§«  = ¬Š®­áâ._â–¥«®¥, áâà®ª _, ¯®§¨æ_, ¬Š®._®è43);
        ‚ëà ¦¥­¨¥_‡ £àã§¨âì(e2);
        …‘‹ˆ e1.â¨¯.â¨¯_ã§«  = ¬Š®­áâ._â„«¨­‚¥é ’Žƒ„€
            X86.StProc(¬Š®­áâ._stPACK)
        ˆ€—…
            X86.StProc(¬Š®­áâ._stPACK1)
        ŠŽ…–
    ŠŽ…– Func_PACK3;

Ž–…„“€ Func_BIT1*(……Œ ¢ëà ¦¥­¨¥_: ¬„¥æ.â‚ëà ¦¥­¨¥; ……Œ áâà®ª _, ¯®§¨æ_:–…‹Ž…; ……Œ ¤¢‡­ ç_: „‹ˆ‚…™);
    €—€‹Ž
        ¬à®¢.à®¢¥à¨âì(¢ëà ¦¥­¨¥_.â¨¯.â¨¯_ã§«  = ¬Š®­áâ._â–¥«®¥, áâà®ª _, ¯®§¨æ_, ¬Š®._®è43);
        ‡ £àã§¨âì_à®¢¥à¨âì(¢ëà ¦¥­¨¥_, ¬Š®­áâ._®¯‡¯â);
        Š®®à¤‘«¥¤ãîé_“áâ(áâà®ª _, ¯®§¨æ_);
    ŠŽ…– Func_BIT1;

Ž–…„“€ Func_BIT2*(……Œ ¢ëà ¦¥­¨¥_: ¬„¥æ.â‚ëà ¦¥­¨¥; ……Œ áâà®ª _, ¯®§¨æ_:–…‹Ž…; ……Œ ¤¢‡­ ç_: „‹ˆ‚…™);
    €—€‹Ž
        ¬à®¢.à®¢¥à¨âì(¢ëà ¦¥­¨¥_.â¨¯.â¨¯_ã§«  = ¬Š®­áâ._â–¥«®¥, áâà®ª _, ¯®§¨æ_, ¬Š®._®è43);
        ‚ëà ¦¥­¨¥_‡ £àã§¨âì(¢ëà ¦¥­¨¥_)
    ŠŽ…– Func_BIT2;

Ž–…„“€ Func_MOVE1*(……Œ ¢ëà ¦¥­¨¥_: ¬„¥æ.â‚ëà ¦¥­¨¥; ……Œ áâà®ª _, ¯®§¨æ_:–…‹Ž…; ……Œ ¤¢‡­ ç_: „‹ˆ‚…™;
        ……Œ begcall: X86.â€á¬“§¥«);
    €—€‹Ž
        ¬à®¢.à®¢¥à¨âì(¢ëà ¦¥­¨¥_.â¨¯.â¨¯_ã§«  = ¬Š®­áâ._â–¥«®¥, áâà®ª _, ¯®§¨æ_, ¬Š®._®è43);
        ‡ £àã§¨âì_à®¢¥à¨âì(¢ëà ¦¥­¨¥_, ¬Š®­áâ._®¯‡¯â);
        X86.PushCall(begcall);
        X86.Param;
        Š®®à¤‘«¥¤ãîé_“áâ(áâà®ª _, ¯®§¨æ_);
    ŠŽ…– Func_MOVE1;

Ž–…„“€ Func_MOVE2*(……Œ ¢ëà ¦¥­¨¥_: ¬„¥æ.â‚ëà ¦¥­¨¥; ……Œ áâà®ª _, ¯®§¨æ_:–…‹Ž…; ……Œ ¤¢‡­ ç_: „‹ˆ‚…™);
    €—€‹Ž
        ¬à®¢.à®¢¥à¨âì(¢ëà ¦¥­¨¥_.â¨¯.â¨¯_ã§«  = ¬Š®­áâ._â–¥«®¥, áâà®ª _, ¯®§¨æ_, ¬Š®._®è43);
        ‡ £àã§¨âì_à®¢¥à¨âì(¢ëà ¦¥­¨¥_, ¬Š®­áâ._®¯‡¯â);
        X86.EndCall;
        Š®®à¤‘«¥¤ãîé_“áâ(áâà®ª _, ¯®§¨æ_);
    ŠŽ…– Func_MOVE2;

Ž–…„“€ Func_MOVE3*(……Œ ¢ëà ¦¥­¨¥_: ¬„¥æ.â‚ëà ¦¥­¨¥; ……Œ áâà®ª _, ¯®§¨æ_:–…‹Ž…; ……Œ ¤¢‡­ ç_: „‹ˆ‚…™);
    €—€‹Ž
        ¬à®¢.à®¢¥à¨âì(¢ëà ¦¥­¨¥_.â¨¯.â¨¯_ã§«  = ¬Š®­áâ._â–¥«®¥, áâà®ª _, ¯®§¨æ_, ¬Š®._®è43);
        ‚ëà ¦¥­¨¥_‡ £àã§¨âì(¢ëà ¦¥­¨¥_);
    ŠŽ…– Func_MOVE3;

ŠŽ…– modFuncCompiler.
